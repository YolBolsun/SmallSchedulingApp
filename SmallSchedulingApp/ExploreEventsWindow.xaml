<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="SmallSchedulingApp.ExploreEventsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SmallSchedulingApp"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Explore Events">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid Padding="20" Background="{ThemeResource LayerFillColorDefaultBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Filter buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Loading/error message -->
            <RowDefinition Height="*"/>
            <!-- Events grid -->
        </Grid.RowDefinitions>

        <!-- Filter Buttons -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,16">
            <TextBlock Text="Filter:" FontSize="16" VerticalAlignment="Center" Margin="0,0,12,0"/>
            <ToggleButton x:Name="AllFilterButton" Content="All" IsChecked="True" Click="FilterButton_Click" Tag="All" MinWidth="80"/>
            <ToggleButton x:Name="MovieFilterButton" Content="Movie" Click="FilterButton_Click" Tag="Movie" MinWidth="80"/>
            <ToggleButton x:Name="ShowFilterButton" Content="Show" Click="FilterButton_Click" Tag="Show" MinWidth="80"/>
            <ToggleButton x:Name="AnimeFilterButton" Content="Anime" Click="FilterButton_Click" Tag="Anime" MinWidth="80"/>
        </StackPanel>

        <!-- Loading/Error Message -->
        <TextBlock x:Name="MessageText" Grid.Row="1" Text="Loading events..." FontSize="14" Margin="0,0,0,12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

        <!-- Events ScrollViewer and Grid -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="EventsItemsControl">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="3"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="12"
                                Margin="8"
                                Width="250"
                                Height="480"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <!-- Scrollable content -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Button -->
                                </Grid.RowDefinitions>

                                <!-- Scrollable Content -->
                                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                                    <StackPanel Spacing="8">
                                        <!-- Event Image -->
                                        <Image Source="{Binding ImageUrl}"
                                               MaxWidth="200"
                                               MaxHeight="200"
                                               Stretch="Uniform"
                                               HorizontalAlignment="Center"/>

                                        <!-- Event Name -->
                                        <TextBlock Text="{Binding Name}"
                                                   FontSize="16"
                                                   FontWeight="SemiBold"
                                                   TextWrapping="Wrap"/>

                                        <!-- Event Summary -->
                                        <TextBlock Text="{Binding Summary}"
                                                   FontSize="12"
                                                   TextWrapping="Wrap"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                                        <!-- Event Details -->
                                        <StackPanel Spacing="4">
                                            <TextBlock Text="{Binding StartDate}"
                                                       FontSize="11"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <TextBlock FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                <Run Text="Frequency: "/>
                                                <Run Text="{Binding Frequency}"/>
                                            </TextBlock>
                                            <TextBlock FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                <Run Text="Occurrences: "/>
                                                <Run Text="{Binding Count}"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </StackPanel>
                                </ScrollViewer>

                                <!-- Add Event Button (Always visible at bottom) -->
                                <Button Grid.Row="1"
                                        Content="Add to Calendar"
                                        HorizontalAlignment="Stretch"
                                        Click="AddEventButton_Click"
                                        Tag="{Binding}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        Margin="0,8,0,0"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Window>
